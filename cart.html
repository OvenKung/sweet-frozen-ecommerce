<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
  <title>üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Äî Sweet Frozen</title>
  <!-- Font Awesome for Icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <!-- Bubble Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&family=Nunito:wght@300;400;500;600;700;800;900&family=Prompt:wght@300;400;500;600;700&family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      // JIT is default in CDN; keep explicit for clarity
      mode: 'jit',
      theme: {
        screens: {
          sm: '640px',
          md: '768px',
          lg: '1024px',
          xl: '1280px',
          '2xl': '1536px'
        },
        extend: {
          fontFamily: {
            'bubble': ['Fredoka', 'Prompt', 'Kanit', 'sans-serif'],
            'round': ['Nunito', 'Prompt', 'sans-serif'],
            'thai': ['Prompt', 'Kanit', 'sans-serif'],
            'thai-bubble': ['Kanit', 'Prompt', 'Fredoka', 'sans-serif'],
          },
          colors: {
            'pastel-pink': '#ffb3ba',
            'pastel-peach': '#ffdfba',
            'pastel-yellow': '#ffffba',
            'pastel-green': '#baffc9',
            'pastel-blue': '#bae1ff',
            'pastel-purple': '#e1baff',
            'pastel-lavender': '#f0e6ff',
            'primary': '#ff8fab',
            'primary-hover': '#ff6b9d',
            'secondary': '#c8e6c9',
            'accent': '#b39ddb'
          },
          animation: {
            float: 'float 3s ease-in-out infinite',
            'slide-in-up': 'slideInUp 0.8s ease-out',
            'slide-in-left': 'slideInLeft 0.8s ease-out',
            'bounce-in': 'bounceIn 0.8s ease-out',
            sparkle: 'sparkle 2s ease-in-out infinite',
            wobble: 'wobble 0.5s ease-in-out'
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' }
            },
            slideInUp: {
              from: { opacity: '0', transform: 'translateY(30px)' },
              to: { opacity: '1', transform: 'translateY(0)' }
            },
            slideInLeft: {
              from: { opacity: '0', transform: 'translateX(-30px)' },
              to: { opacity: '1', transform: 'translateX(0)' }
            },
            bounceIn: {
              '0%': { opacity: '0', transform: 'scale(0.3)' },
              '50%': { opacity: '1', transform: 'scale(1.05)' },
              '100%': { opacity: '1', transform: 'scale(1)' }
            },
            sparkle: {
              '0%, 100%': { opacity: '1', transform: 'scale(1) rotate(0deg)' },
              '50%': { opacity: '0.7', transform: 'scale(1.2) rotate(180deg)' }
            },
            wobble: {
              '0%, 100%': { transform: 'rotate(0deg)' },
              '25%': { transform: 'rotate(-3deg)' },
              '75%': { transform: 'rotate(3deg)' }
            }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="./assets/css/styles.css"/>
  <script type="module" src="./assets/js/app.js"></script>
</head>
<body class="font-bubble bg-gradient-to-br from-pastel-pink via-pastel-lavender to-pastel-mint min-h-screen">
  <div id="app-header"></div>
  <main class="max-w-6xl mx-auto px-2 sm:px-4 lg:px-6 py-4">
    <h2 class="text-center text-primary text-2xl sm:text-3xl lg:text-4xl font-black mb-6 sm:mb-8">
      üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    </h2>
    
    <div class="bg-gradient-to-br from-white to-purple-50 p-3 sm:p-4 lg:p-6 rounded-2xl sm:rounded-3xl shadow-xl mb-4 sm:mb-6">
      <div class="overflow-x-auto">
        <table class="w-full border-collapse bg-white border-2 border-pastel-green rounded-xl sm:rounded-2xl overflow-hidden shadow-lg" id="cartTable">
          <thead>
            <tr class="bg-gradient-to-r from-pastel-pink to-pastel-peach">
              <th class="p-2 sm:p-3 lg:p-4 text-left font-bold text-xs sm:text-sm lg:text-base">üç¶ ‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°</th>
              <th class="p-2 sm:p-3 lg:p-4 text-left font-bold text-xs sm:text-sm lg:text-base hidden sm:table-cell">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤</th>
              <th class="p-2 sm:p-3 lg:p-4 text-left font-bold text-xs sm:text-sm lg:text-base">üì¶ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
              <th class="p-2 sm:p-3 lg:p-4 text-left font-bold text-xs sm:text-sm lg:text-base">üíµ ‡∏£‡∏ß‡∏°</th>
              <th class="p-2 sm:p-3 lg:p-4 text-left font-bold text-xs sm:text-sm lg:text-base">üóëÔ∏è</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr class="bg-pastel-lavender">
              <td colspan="3" class="sm:hidden p-2 text-right text-sm font-bold">üíù ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
              <td colspan="3" class="hidden sm:table-cell p-2 sm:p-3 lg:p-4 text-right text-base sm:text-lg font-bold">üíù ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
              <td id="subtotal" class="p-2 sm:p-3 lg:p-4 text-primary text-lg sm:text-xl font-black">‡∏ø0</td>
              <td class="hidden sm:table-cell p-2 sm:p-3 lg:p-4"></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-3 justify-center sm:justify-end">
      <a class="bg-white border-2 border-pastel-pink text-purple-700 font-bold py-3 px-4 sm:px-6 rounded-xl sm:rounded-2xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 text-center text-sm sm:text-base" href="./index.html">üç¶ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏ï‡πà‡∏≠</a>
      <button id="checkoutBtn" class="bg-gradient-to-r from-primary to-primary-hover text-white font-bold py-3 px-4 sm:px-6 rounded-xl sm:rounded-2xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 border-2 border-primary text-sm sm:text-base min-h-[44px]">üí≥ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢!</button>
    </div>
  </main>
  <div id="app-footer"></div>
  
  <script type="module">
    import { Cart } from './assets/js/cart.js';
    import { PRODUCTS, getProduct, loadIceCreamProducts } from './assets/js/products.js';
    import { toast, updateHeader, renderHeader, renderFooter, initializeGlobalStyles, initializeQuickCart } from './assets/js/ui.js';
    import { currentUser, logout } from './assets/js/auth.js';

    // Create global cart instance
    const cart = Cart;

    document.addEventListener('DOMContentLoaded', async function() {
        // Initialize global styles and theme
        initializeGlobalStyles();
        initializeQuickCart();
        renderHeader();
        renderFooter();
        
        // Load products first - ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô render
        let productsLoaded = false;
        try {
            await loadIceCreamProducts();
            productsLoaded = true;
            console.log('‚úÖ Products loaded from JSON:', PRODUCTS.length);
        } catch (error) {
            console.error('‚ùå Error loading products from JSON:', error);
            // ‡πÉ‡∏ä‡πâ fallback products ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô products.js
            console.log('üì¶ Using fallback products:', PRODUCTS.length);
        }
        
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ PRODUCTS ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        console.log('üîç PRODUCTS check:', {
            hasProducts: !!PRODUCTS,
            length: PRODUCTS ? PRODUCTS.length : 0,
            sample: PRODUCTS ? PRODUCTS.slice(0, 2) : 'none',
            hasWindow: !!window.PRODUCTS,
            windowLength: window.PRODUCTS ? window.PRODUCTS.length : 0
        });
        
        if (!PRODUCTS || PRODUCTS.length === 0) {
            console.error('‚ùå No products available, even fallback failed!');
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á fallback products ‡πÅ‡∏ö‡∏ö hard-coded
            window.PRODUCTS = [
                {id:"ic-001", name:"‡∏ß‡∏≤‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å", price:45, image:"https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=600&h=400&fit=crop"},
                {id:"ic-002", name:"‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏î‡∏≤‡∏£‡πå‡∏Å", price:55, image:"https://images.unsplash.com/photo-1551024506-0bccd828d307?w=600&h=400&fit=crop"},
                {id:"ic-003", name:"‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡πÄ‡∏ü‡∏£‡∏ä", price:50, image:"https://images.unsplash.com/photo-1629203851122-3726ecdf080e?w=600&h=400&fit=crop"}
            ];
            console.log('üîß Created emergency fallback products:', window.PRODUCTS.length);
        }
        
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å render ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å products ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß
        render();
        
        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á ‡∏•‡∏≠‡∏á render ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°
        setTimeout(() => {
            const tbody = document.querySelector('#cartTable tbody');
            if (tbody && tbody.children.length <= 1) {
                console.log('üîÑ Retrying render...');
                render();
            }
        }, 500);

        // Load users data
        try {
            const { loadUsers } = await import('./assets/js/auth.js');
            await loadUsers();
        } catch (error) {
            console.error('Error loading users:', error);
        }

        // Update navbar
        setTimeout(() => {
            updateHeader();
        }, 100);

        // Setup event listeners
        setupEventListeners();
    });

    function updateCartSummary() {
        const subtotalEl = document.getElementById('subtotal');
        if (!subtotalEl) return;
        
        const pricing = Cart.calculatePricing(PRODUCTS || window.PRODUCTS || []);
        
        // Update the display to show final total
        subtotalEl.innerHTML = `
            <div class="space-y-1">
                <div class="font-bold">‡∏ø${pricing.total.toLocaleString()}</div>
            </div>
        `;
    }

    function setupEventListeners() {
        const checkoutBtn = document.getElementById('checkoutBtn');

        if (checkoutBtn) {
            checkoutBtn.addEventListener('click', async function(e) {
                e.preventDefault();
                
                if (checkoutBtn.disabled) {
                    toast('‚ùå ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                    return;
                }
                
                // ‡∏£‡∏≠‡πÉ‡∏´‡πâ users ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö user
        try {
          const { loadUsers } = await import('./assets/js/auth.js');
          await loadUsers();
        } catch (error) {
        }
                
                const user = currentUser();
                
                if (!user) {
                    // ‡∏•‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô localStorage ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
                    const currentAuth = localStorage.getItem('app.auth.current.v1');
                    if (currentAuth) {
                        toast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ Login ‡πÉ‡∏´‡∏°‡πà');
                    } else {
                        toast('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
                    }
                    setTimeout(() => {
                        location.href = './login.html?redirect=' + encodeURIComponent('./checkout.html');
                    }, 1500);
                    return;
                }
                
                const cart = Cart.get();
                if (!cart.items.length) {
                    toast('‚ùå ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤');
                    return;
                }
                
                checkoutBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
                checkoutBtn.disabled = true;
                
                setTimeout(() => {
                    location.href = './checkout.html';
                }, 500);
            });
        }
    }

    function priceOf(id) { 
        const p = getProductLocal(id); 
        return p ? p.price : 0; 
    }

    // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á getProduct ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ fallback ‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
    function getProductLocal(id) {
        console.log('üîç getProductLocal called for:', id);
        
        // ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏à‡∏≤‡∏Å PRODUCTS ‡∏Å‡πà‡∏≠‡∏ô
        let product = PRODUCTS ? PRODUCTS.find(p => p.id === id) : null;
        console.log('üì¶ Found in PRODUCTS:', product ? product.name : 'not found');
        
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÉ‡∏ä‡πâ fallback
        if (!product && window.PRODUCTS) {
            product = window.PRODUCTS.find(p => p.id === id);
            console.log('üì¶ Found in window.PRODUCTS:', product ? product.name : 'not found');
        }
        
        // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡∏™‡∏£‡πâ‡∏≤‡∏á placeholder
        if (!product) {
            console.log('üîß Using emergency fallback products');
            const fallbackProducts = [
                {id:"ic-001", name:"‡∏ß‡∏≤‡∏ô‡∏¥‡∏•‡∏•‡∏≤‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏¥‡∏Å", price:45, image:"https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=600&h=400&fit=crop"},
                {id:"ic-002", name:"‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï‡∏î‡∏≤‡∏£‡πå‡∏Å", price:55, image:"https://images.unsplash.com/photo-1551024506-0bccd828d307?w=600&h=400&fit=crop"},
                {id:"ic-003", name:"‡∏™‡∏ï‡∏£‡∏≠‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ‡πà‡πÄ‡∏ü‡∏£‡∏ä", price:50, image:"https://images.unsplash.com/photo-1629203851122-3726ecdf080e?w=600&h=400&fit=crop"},
                {id:"ic-004", name:"‡∏°‡∏¥‡∏ô‡∏ï‡πå‡∏ä‡πá‡∏≠‡∏Å‡∏ä‡∏¥‡∏õ", price:60, image:"https://images.unsplash.com/photo-1497034825429-c343d7c6a68f?w=600&h=400&fit=crop"},
                {id:"ic-005", name:"‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡πÅ‡∏≠‡∏ô‡∏î‡πå‡∏Ñ‡∏£‡∏µ‡∏°", price:65, image:"https://images.unsplash.com/photo-1570197788417-0e82375c9371?w=600&h=400&fit=crop"}
            ];
            product = fallbackProducts.find(p => p.id === id);
            console.log('üì¶ Found in emergency fallback:', product ? product.name : 'still not found');
        }
        
        return product || {
            id: id,
            name: `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${id}`,
            price: 50,
            image: "https://images.unsplash.com/photo-1563805042-7684c019e1cb?w=600&h=400&fit=crop"
        };
    }

    function render() {
        console.log('üîÑ Render called');
        const tbody = document.querySelector('#cartTable tbody');
        if (!tbody) {
            console.error('‚ùå tbody not found');
            return;
        }
        
        tbody.innerHTML = '';
        const c = Cart.get();
        console.log('üì¶ Cart data:', c);
        console.log('üç¶ PRODUCTS array:', PRODUCTS.length, PRODUCTS.slice(0, 3));
        
        const checkoutBtn = document.getElementById('checkoutBtn');
        
        if (!c.items || !c.items.length) {
            console.log('üì≠ Cart is empty or no items');
            tbody.innerHTML = '<tr><td colspan="5" class="p-2 sm:p-3 lg:p-4 text-center text-gray-500 text-sm sm:text-base">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ üõí</td></tr>';
            
            if (checkoutBtn) {
                checkoutBtn.disabled = true;
                checkoutBtn.className = checkoutBtn.className.replace('from-primary to-primary-hover', 'from-gray-300 to-gray-400');
                checkoutBtn.style.cursor = 'not-allowed';
            }
            return;
        }

        console.log('üõí Processing cart items:', c.items.length);
        
        if (checkoutBtn) {
            checkoutBtn.disabled = false;
            checkoutBtn.className = checkoutBtn.className.replace('from-gray-300 to-gray-400', 'from-primary to-primary-hover');
            checkoutBtn.style.cursor = 'pointer';
            checkoutBtn.innerHTML = 'üí≥ ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢!';
        }
        
        for (const it of c.items) {
            console.log(`üîç Processing item: ${it.productId}, qty: ${it.qty}`);
            const p = getProductLocal(it.productId);  // ‡πÉ‡∏ä‡πâ getProductLocal
            console.log(`üì¶ Product found:`, p);
            
            if (!p) {
                console.warn(`‚ùå Product ${it.productId} not found`);
                // ‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÅ‡∏™‡∏î‡∏á placeholder
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td colspan="5" class="p-2 sm:p-3 lg:p-4 text-center text-red-500 text-sm">
                        ‚ùå ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ID: ${it.productId} ‡πÑ‡∏°‡πà‡∏û‡∏ö (‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß)
                    </td>
                `;
                tbody.appendChild(tr);
                continue;
            }
            
            console.log(`‚úÖ Creating row for: ${p.name}`);
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td class="p-2 sm:p-3 lg:p-4">
                    <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3">
                        <img src="${p.image}" alt="" class="w-12 h-9 sm:w-16 sm:h-12 object-cover rounded border border-gray-200"/>
                        <div class="flex-1 min-w-0">
                            <a href="./product.html?id=${p.id}" class="text-blue-600 hover:underline text-xs sm:text-sm lg:text-base font-medium leading-tight block">${p.name}</a>
                            <div class="sm:hidden text-xs text-gray-600 mt-1">‡∏ø${p.price.toLocaleString()}</div>
                        </div>
                    </div>
                </td>
                <td class="hidden sm:table-cell p-2 sm:p-3 lg:p-4 text-sm sm:text-base">‡∏ø${p.price.toLocaleString()}</td>
                <td class="p-2 sm:p-3 lg:p-4">
                    <input data-id="${p.id}" class="qty w-14 sm:w-20 px-2 py-1 border rounded text-xs sm:text-sm text-center" type="number" min="1" value="${it.qty}"/>
                </td>
                <td class="p-2 sm:p-3 lg:p-4 font-bold text-sm sm:text-base">‡∏ø${(p.price * it.qty).toLocaleString()}</td>
                <td class="p-2 sm:p-3 lg:p-4">
                    <button class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-xs sm:text-sm min-h-[32px] w-full sm:w-auto" data-rm="${p.id}">üóëÔ∏è<span class="hidden sm:inline"> ‡∏•‡∏ö</span></button>
                </td>
            `;
            tbody.appendChild(tr);
        }
        
        // Update subtotal using cart pricing with coupon support
        updateCartSummary();
        
        // Update cart count in navbar
        const cartCountEl = document.getElementById('cartCount');
        if (cartCountEl) {
            cartCountEl.textContent = Cart.count();
        }
        
        // Setup quantity change listeners
        tbody.querySelectorAll('.qty').forEach(inp => {
            inp.addEventListener('change', (e) => {
                const id = e.target.getAttribute('data-id');
                const q = Math.max(1, parseInt(e.target.value || '1', 10));
                Cart.setQty(id, q);
                render();
            });
        });
        
        // Setup remove button listeners
        tbody.querySelectorAll('[data-rm]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const target = e.target.closest('[data-rm]') || e.currentTarget;
                const id = target.getAttribute('data-rm');
                Cart.remove(id);
                toast('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
                render();
            });
        });
        
        console.log('üéØ Render completed, rows added:', tbody.children.length);
    }
  </script>

  <!-- Floating Action Buttons -->
  <div class="fixed right-6 bottom-6 flex flex-col gap-3 z-50">
      <!-- Dark Mode Toggle -->
      <button id="darkModeToggle" class="w-12 h-12 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center">
          <i class="fas fa-moon text-lg"></i>
      </button>
      
      <!-- Quick Cart Button -->
      <button id="quickCartBtn" class="w-12 h-12 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg transition-all duration-300 hover:scale-110 flex items-center justify-center relative">
          <i class="fas fa-shopping-cart text-lg"></i>
          <span id="quickCartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center hidden">0</span>
      </button>
  </div>

  <!-- Quick Cart Popup -->
  <div id="quickCartPopup" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
      <div class="fixed right-0 top-0 h-full w-96 bg-white dark:bg-gray-800 shadow-lg transform translate-x-full transition-transform duration-300">
          <div class="p-6 border-b dark:border-gray-700">
              <div class="flex justify-between items-center">
                  <h3 class="text-lg font-bold text-gray-800 dark:text-white">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                  <button id="closeQuickCart" class="text-gray-600 dark:text-gray-400 hover:text-red-500">
                      <i class="fas fa-times text-xl"></i>
                  </button>
              </div>
          </div>
          <div id="quickCartContent" class="p-6 max-h-96 overflow-y-auto">
              <!-- Cart items will be rendered here -->
          </div>
          <div class="p-6 border-t dark:border-gray-700">
              <div class="flex justify-between items-center mb-4">
                  <span class="font-bold text-gray-800 dark:text-white">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                  <span id="quickCartTotal" class="font-bold text-blue-600 dark:text-blue-400">‡∏ø0</span>
              </div>
              <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-3 rounded-lg transition-colors duration-300" onclick="window.location.href='cart.html'">
                  ‡∏î‡∏π‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
              </button>
          </div>
      </div>
  </div>
</body>
</html>
