<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes"/>
  <title>üç¶ Sweet Frozen - ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      mode: 'jit',
      theme: {
        screens: {
          'sm': '640px',
          'md': '768px', 
          'lg': '1024px',
          'xl': '1280px',
          '2xl': '1536px',
        },
        extend: {
          colors: {
            'pastel-pink': '#ffb3ba',
            'pastel-peach': '#ffdfba',
            'pastel-yellow': '#ffffba',
            'pastel-green': '#baffc9',
            'pastel-blue': '#bae1ff',
            'pastel-purple': '#e1baff',
            'pastel-lavender': '#f0e6ff',
            'primary': '#ff8fab',
            'primary-hover': '#ff6b9d',
            'secondary': '#c8e6c9',
            'accent': '#b39ddb',
          },
          animation: {
            'float': 'float 3s ease-in-out infinite',
            'slide-in-up': 'slideInUp 0.8s ease-out',
            'slide-in-left': 'slideInLeft 0.8s ease-out',
            'bounce-in': 'bounceIn 0.8s ease-out',
            'sparkle': 'sparkle 2s ease-in-out infinite',
            'wobble': 'wobble 0.5s ease-in-out'
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
              '50%': { transform: 'translateY(-10px) rotate(2deg)' }
            },
            slideInUp: {
              from: { opacity: '0', transform: 'translateY(30px)' },
              to: { opacity: '1', transform: 'translateY(0)' }
            },
            slideInLeft: {
              from: { opacity: '0', transform: 'translateX(-30px)' },
              to: { opacity: '1', transform: 'translateX(0)' }
            },
            bounceIn: {
              '0%': { opacity: '0', transform: 'scale(0.3)' },
              '50%': { opacity: '1', transform: 'scale(1.05)' },
              '100%': { opacity: '1', transform: 'scale(1)' }
            },
            sparkle: {
              '0%, 100%': { opacity: '1', transform: 'scale(1) rotate(0deg)' },
              '50%': { opacity: '0.7', transform: 'scale(1.2) rotate(180deg)' }
            },
            wobble: {
              '0%, 100%': { transform: 'rotate(0deg)' },
              '25%': { transform: 'rotate(-3deg)' },
              '75%': { transform: 'rotate(3deg)' }
            }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="./assets/css/styles.css"/>
  <link rel="stylesheet" href="./assets/css/responsive-fixes.css"/>
  <script src="./assets/js/responsive-enhancer.js"></script>
  <script src="./assets/js/hero-fix.js"></script>
  <script type="module" src="./assets/js/app.js"></script>
</head>
<body>
  <div id="app-header"></div>
  <main class="max-w-7xl mx-auto px-2 sm:px-4 lg:px-6 py-4 sm:py-6 animate-slide-in-up">
    <!-- Hero Section -->
    <section class="mb-6 sm:mb-10">
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-5 gap-4 sm:gap-6">
        <!-- Main Welcome Section with Image Slider -->
        <div class="md:col-span-1 xl:col-span-3 bg-gradient-to-br from-white to-purple-50 border-2 border-pastel-peach rounded-2xl sm:rounded-3xl p-4 sm:p-6 lg:p-8 shadow-xl relative overflow-hidden">
          <!-- Image Slider Background -->
          <div class="absolute inset-0 opacity-10 overflow-hidden">
            <div id="heroSlider" class="relative w-full h-full">
              <div class="hero-slide absolute inset-0 transition-opacity duration-1000 opacity-100">
                <img src="https://images.unsplash.com/photo-1567206563064-6f60f40a2b57?w=800&h=600&fit=crop" alt="Ice cream background" class="w-full h-full object-cover"/>
              </div>
              <div class="hero-slide absolute inset-0 transition-opacity duration-1000 opacity-0">
                <img src="https://images.unsplash.com/photo-1576506295286-5cda18df43e7?w=800&h=600&fit=crop" alt="Ice cream shop" class="w-full h-full object-cover"/>
              </div>
              <div class="hero-slide absolute inset-0 transition-opacity duration-1000 opacity-0">
                <img src="https://images.unsplash.com/photo-1497034825429-c343d7c6a68f?w=800&h=600&fit=crop" alt="Ice cream variety" class="w-full h-full object-cover"/>
              </div>
            </div>
          </div>

          <!-- Content (positioned above slider) -->
          <div class="relative z-10">
            <h1 class="text-2xl sm:text-4xl lg:text-5xl xl:text-6xl font-black bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent mb-4 sm:mb-6 animate-bounce leading-tight">
              üç¶ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà<br class="hidden sm:block">Sweet Frozen
            </h1>
            <p class="text-base sm:text-xl text-purple-700 mb-4 sm:mb-6 leading-relaxed">
              ‚ú® ‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥ ‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà ‡∏≠‡∏£‡πà‡∏≠‡∏¢ ‡πÄ‡∏¢‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏ô‡πÉ‡∏à ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì! ‚ú®
            </p>
            
            <!-- Feature Badges -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
              <div class="bg-pastel-pink/90 backdrop-blur-sm px-4 py-3 rounded-2xl text-center border-2 border-pink-200 shadow-md">
                <div class="text-2xl mb-1">üöö</div>
                <div class="text-sm font-bold">‡∏ü‡∏£‡∏µ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á</div>
                <div class="text-xs text-purple-600">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏ö ‡∏ø1,500</div>
              </div>
              <div class="bg-pastel-blue/90 backdrop-blur-sm px-4 py-3 rounded-2xl text-center border-2 border-blue-200 shadow-md">
                <div class="text-2xl mb-1">üí≥</div>
                <div class="text-sm font-bold">‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï</div>
                <div class="text-xs text-purple-600">‡∏ä‡∏≥‡∏£‡∏∞‡∏á‡πà‡∏≤‡∏¢ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</div>
              </div>
              <div class="bg-pastel-green/90 backdrop-blur-sm px-4 py-3 rounded-2xl text-center border-2 border-green-200 shadow-md">
                <div class="text-2xl mb-1">‚ùÑÔ∏è</div>
                <div class="text-sm font-bold">‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô</div>
                <div class="text-xs text-purple-600">4-6 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</div>
              </div>
            </div>
            
            <p class="text-center text-purple-600 text-sm">
              üéÆ ‡∏Å‡∏î <kbd class="bg-pastel-yellow/90 backdrop-blur-sm border-2 border-pastel-peach rounded px-2 py-1 font-bold">Alt</kbd>+<kbd class="bg-pastel-yellow/90 backdrop-blur-sm border-2 border-pastel-peach rounded px-2 py-1 font-bold">Shift</kbd>+<kbd class="bg-pastel-yellow/90 backdrop-blur-sm border-2 border-pastel-peach rounded px-2 py-1 font-bold">R</kbd> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏£‡∏∞‡∏ö‡∏ö
            </p>
          </div>
        </div>
        
        <!-- Featured Products Carousel -->
        <div class="md:col-span-1 xl:col-span-2 bg-gradient-to-br from-white to-purple-50 border-2 border-pastel-peach rounded-2xl sm:rounded-3xl p-4 sm:p-6 shadow-xl">
          <div class="text-center mb-3 sm:mb-4">
            <div class="inline-block bg-pastel-yellow px-3 sm:px-4 py-2 rounded-full text-base sm:text-lg font-black text-primary border-2 border-yellow-300 animate-bounce">
              ‚≠ê ‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            </div>
          </div>
          
          <!-- Featured Products Slider -->
          <div class="relative" id="featuredContainer">
            <div class="overflow-hidden rounded-2xl">
              <div id="featuredSlider" class="flex transition-transform duration-300 ease-in-out">
                <!-- Featured products will be inserted here -->
              </div>
            </div>
            
            <!-- Navigation Buttons -->
            <button id="featuredPrev" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 backdrop-blur-sm hover:bg-white/90 text-primary p-2 rounded-full shadow-lg transition-all duration-300 hover:scale-110 z-10">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </button>
            <button id="featuredNext" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 backdrop-blur-sm hover:bg-white/90 text-primary p-2 rounded-full shadow-lg transition-all duration-300 hover:scale-110 z-10">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </button>
            
            <!-- Dots Indicator -->
            <div class="flex justify-center mt-3 gap-2" id="featuredDots">
              <!-- Dots will be inserted here -->
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <!-- All Products Section -->
    <div class="text-center mb-6 sm:mb-8">
      <h2 class="text-2xl sm:text-3xl lg:text-4xl font-black text-primary mb-2">üç® ‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
      <p class="text-sm sm:text-base text-purple-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡πÇ‡∏õ‡∏£‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
    </div>

    <!-- Search and Filter Section -->
    <div class="bg-white/80 backdrop-blur-sm rounded-2xl sm:rounded-3xl shadow-xl p-4 sm:p-6 mb-6 sm:mb-8 border border-white/20">
      <div class="flex flex-col lg:flex-row gap-3 sm:gap-4 items-stretch lg:items-center">
        <!-- Search Bar -->
        <div class="flex-1 relative">
          <input 
            type="text" 
            id="searchInput"
            placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°..." 
            class="w-full px-4 py-3 pl-12 rounded-2xl border-2 border-pastel-pink/30 focus:border-pastel-pink focus:outline-none transition-all duration-300"
          >
          <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
            üîç
          </div>
        </div>
        
        <!-- Category Filter -->
        <select id="categoryFilter" class="px-3 sm:px-4 py-3 rounded-xl sm:rounded-2xl border-2 border-pastel-purple/30 focus:border-pastel-purple focus:outline-none transition-all duration-300 bg-white min-w-[140px] sm:min-w-[180px] text-sm sm:text-base">
          <option value="">üç¶ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="Fruit">üçì ‡∏ú‡∏•‡πÑ‡∏°‡πâ</option>
          <option value="Chocolate">üç´ ‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï</option>
          <option value="Yogurt">ü•õ ‡πÇ‡∏¢‡πÄ‡∏Å‡∏¥‡∏£‡πå‡∏ï</option>
          <option value="Asian">üçµ ‡∏£‡∏™‡∏ä‡∏≤‡∏ï‡∏¥‡πÄ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢</option>
        </select>
        
        <!-- Price Range -->
        <select id="priceFilter" class="px-3 sm:px-4 py-3 rounded-xl sm:rounded-2xl border-2 border-pastel-green/30 focus:border-pastel-green focus:outline-none transition-all duration-300 bg-white min-w-[120px] sm:min-w-[150px] text-sm sm:text-base">
          <option value="">üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="0-40">‡∏ø0 - ‡∏ø40</option>
          <option value="41-55">‡∏ø41 - ‡∏ø55</option>
          <option value="56-100">‡∏ø56 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-4 sm:gap-6" id="productGrid"></div>
  </main>
  <div id="app-footer"></div>
  
  <!-- Back to Top Button -->
  <button class="back-to-top" onclick="scrollToTop()" title="‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏ô">
    ‚¨ÜÔ∏è
  </button>
  
  <!-- Reading Progress Bar -->
  <div id="progress-bar" style="position: fixed; top: 0; left: 0; width: 0%; height: 3px; background: linear-gradient(90deg, #ff8fab, #e1baff); z-index: 9999; transition: width 0.3s ease;"></div>

  <script type="module">
    import { PRODUCTS, loadIceCreamProducts } from './assets/js/products.js';
    import { Cart } from './assets/js/cart.js';
    import { renderHeader, renderFooter, toast, updateHeader, enableResetHotkey } from './assets/js/ui.js';
    import { currentUser } from './assets/js/auth.js';
    import { 
      loadReviews, 
      getProductRating, 
      getProductReviewStats,
      generateStarRating 
    } from './assets/js/reviews.js';
    
    // Render header and footer first
    renderHeader();
    renderFooter();
    enableResetHotkey();
    
    // Ensure navbar shows correct login state
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        updateHeader();
      }, 100);
    });
    
    function card(p){
      const user = currentUser();
      const isFavorite = user && user.favoriteProducts && user.favoriteProducts.includes(p.id);
      
      const el = document.createElement('div'); 
      el.className='product-card bg-white border-2 border-pastel-blue rounded-xl sm:rounded-2xl overflow-hidden flex flex-col transition-all duration-300 hover:shadow-2xl hover:-translate-y-2 hover:border-primary shadow-lg relative';
      el.style.animationDelay = Math.random() * 0.5 + 's';
      
      // Get rating data
      const rating = getProductRating(p.id);
      const reviewStats = getProductReviewStats(p.id);
      
      el.innerHTML = `
        <!-- Favorite Button -->
        <button class="absolute top-2 right-2 w-8 h-8 rounded-full ${isFavorite ? 'bg-red-500 text-white' : 'bg-white/80 backdrop-blur-sm text-gray-400 hover:text-red-500'} flex items-center justify-center transition-all duration-300 hover:scale-110 z-10 shadow-md" 
                onclick="toggleFavorite('${p.id}', event)">
          ${isFavorite ? '‚ù§Ô∏è' : 'ü§ç'}
        </button>
        
        <a href="./product.html?id=${p.id}" class="block">
          <img src="${p.image}" alt="${p.name}" class="w-full h-36 sm:h-40 lg:h-48 object-cover transition-all duration-300 hover:scale-110"/>
        </a>
        <div class="p-3 sm:p-4 flex flex-col gap-1 sm:gap-2 flex-1">
          <a href="./product.html?id=${p.id}" class="text-primary font-bold text-sm sm:text-base lg:text-lg hover:text-primary-hover transition-colors leading-tight">
            ${p.name}
          </a>
          
          <!-- Rating Display -->
          ${rating > 0 ? `
            <div class="flex items-center gap-1 sm:gap-2 mb-1">
              <div class="flex items-center">
                ${generateStarRating(rating, 'text-xs sm:text-sm')}
              </div>
              <span class="text-xs sm:text-sm text-gray-600">${rating}</span>
              <span class="text-xs text-gray-500">(${reviewStats.totalReviews})</span>
            </div>
          ` : '<div class="text-xs text-gray-400 mb-1">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>'}
          
          <div class="bg-pastel-peach px-2 py-1 rounded-lg sm:rounded-xl text-xs sm:text-sm inline-block w-fit">
            üè∑Ô∏è ${p.category}
          </div>
          <div class="text-lg sm:text-xl lg:text-2xl font-black text-primary">
            ‡∏ø${p.price.toLocaleString()}
          </div>
          <button class="w-full bg-gradient-to-r from-primary to-primary-hover text-white font-bold py-2 sm:py-3 px-3 sm:px-4 rounded-xl sm:rounded-2xl transition-all duration-300 hover:shadow-lg hover:-translate-y-1 border-2 border-primary text-xs sm:text-sm lg:text-base min-h-[44px] mt-auto" data-id="${p.id}">
            üõí <span class="hidden sm:inline">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span><span class="sm:hidden">‡πÄ‡∏û‡∏¥‡πà‡∏°</span>
          </button>
        </div>`;
      
      const button = el.querySelector('button[data-id]');
      button.addEventListener('click', ()=>{
        // Add click animation
        button.style.transform = 'scale(0.95)';
        setTimeout(() => {
          button.style.transform = '';
        }, 150);
        
        Cart.add(p.id,1); 
        document.getElementById('cartCount').textContent = Cart.count();
        toast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß! üç¶');
      });
      return el;
    }
    
    // State for filtering
    let filteredProducts = [];
    let currentSearchTerm = '';
    let currentCategory = '';
    let currentPriceRange = '';

    function filterProducts() {
      const searchTerm = document.getElementById('searchInput')?.value.toLowerCase().trim() || '';
      const category = document.getElementById('categoryFilter')?.value || '';
      const priceRange = document.getElementById('priceFilter')?.value || '';
      
      currentSearchTerm = searchTerm;
      currentCategory = category;
      currentPriceRange = priceRange;
      
      filteredProducts = PRODUCTS.filter(product => {
        // Search filter
        const matchesSearch = searchTerm === '' || 
          product.name.toLowerCase().includes(searchTerm) ||
          product.description.toLowerCase().includes(searchTerm);
        
        // Category filter
        const matchesCategory = category === '' || product.category === category;
        
        // Price filter
        let matchesPrice = true;
        if (priceRange) {
          const [min, max] = priceRange.split('-').map(Number);
          if (max) {
            matchesPrice = product.price >= min && product.price <= max;
          } else {
            matchesPrice = product.price >= min;
          }
        }
        
        return matchesSearch && matchesCategory && matchesPrice;
      });
      
      renderProducts();
      
      // Show results count
      const resultText = filteredProducts.length === PRODUCTS.length 
        ? `‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${filteredProducts.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`
        : `‡∏û‡∏ö ${filteredProducts.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å ${PRODUCTS.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      
      // Update results count display
      let countDisplay = document.getElementById('resultsCount');
      if (!countDisplay) {
        countDisplay = document.createElement('div');
        countDisplay.id = 'resultsCount';
        countDisplay.className = 'text-center text-gray-600 mb-4 text-sm font-medium';
        document.getElementById('productGrid').parentNode.insertBefore(countDisplay, document.getElementById('productGrid'));
      }
      countDisplay.textContent = resultText;
    }

    // Render products immediately with fallback data, then update when JSON loads
    function renderProducts() {
      const grid = document.getElementById('productGrid');
      grid.innerHTML = ''; // Clear existing products
      
      // Use filtered products if filters are active
      let list = (currentSearchTerm || currentCategory || currentPriceRange) ? filteredProducts : PRODUCTS;
      
      // Handle URL search parameter for backward compatibility
      const params = new URLSearchParams(location.search);
      const q = (params.get('q')||'').toLowerCase().trim();
      if(q && !currentSearchTerm){ 
        list = list.filter(p=>p.name.toLowerCase().includes(q) || p.category.toLowerCase().includes(q)); 
        // Set search input if URL has query
        const searchInput = document.getElementById('searchInput');
        if (searchInput) searchInput.value = q;
      }
      
      if (list.length === 0) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-12 bg-white/50 rounded-3xl">
            <div class="text-6xl mb-4">üîç</div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3>
            <p class="text-gray-500 mb-4">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏≠‡∏∑‡πà‡∏ô</p>
            <button onclick="clearFilters()" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90 transition-all">
              üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
            </button>
          </div>
        `;
        return;
      }
      
      list.forEach(p=>grid.appendChild(card(p)));
      
      // Setup Featured Products Carousel
      setupFeaturedCarousel();
    }
    
    // Setup Featured Products Carousel
    let currentFeaturedIndex = 0;
    const featuredProducts = [];

    function setupFeaturedCarousel() {
      if (PRODUCTS.length === 0) return;
      
      // Select top 3 products (you can customize this logic)
      featuredProducts.length = 0;
      featuredProducts.push(
        PRODUCTS[0] || null,
        PRODUCTS[1] || null,
        PRODUCTS[2] || null
      );
      
      // Filter out null values
      const validProducts = featuredProducts.filter(p => p !== null);
      if (validProducts.length === 0) return;
      
      renderFeaturedProducts();
      setupFeaturedNavigation();
    }

    function renderFeaturedProducts() {
      const slider = document.getElementById('featuredSlider');
      const dotsContainer = document.getElementById('featuredDots');
      const user = currentUser();
      const userFavorites = user?.favoriteProducts || [];
      
      if (!slider || featuredProducts.length === 0) return;
      
      // Clear existing content
      slider.innerHTML = '';
      dotsContainer.innerHTML = '';
      
      // Render each featured product
      featuredProducts.forEach((product, index) => {
        if (!product) return;
        
        const rating = getProductRating(product.id);
        const reviewStats = getProductReviewStats(product.id);
        const isFavorite = userFavorites.includes(product.id);
        const favoriteClass = isFavorite 
          ? 'absolute top-2 right-2 w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center transition-all duration-300 hover:scale-110 z-10 shadow-md text-xs'
          : 'absolute top-2 right-2 w-6 h-6 rounded-full bg-white/80 backdrop-blur-sm text-gray-400 hover:text-red-500 flex items-center justify-center transition-all duration-300 hover:scale-110 z-10 shadow-md text-xs';
        const favoriteIcon = isFavorite ? '‚ù§Ô∏è' : 'ü§ç';
        
        const slideDiv = document.createElement('div');
        slideDiv.className = 'w-full flex-shrink-0';
        slideDiv.innerHTML = `
          <div class="text-center p-2 relative">
            <!-- Favorite Button -->
            <button onclick="toggleFavorite('${product.id}', event)" class="${favoriteClass}">
              ${favoriteIcon}
            </button>
            
            <!-- Image -->
            <div class="mb-3">
              <img src="${product.image}" alt="${product.name}" 
                   class="w-20 h-20 sm:w-24 sm:h-24 mx-auto object-cover rounded-full border-4 border-primary shadow-lg transition-transform duration-300 hover:scale-110"/>
            </div>
            
            <!-- Product Info -->
            <h3 class="text-primary font-black text-base sm:text-lg mb-2 leading-tight">${product.name}</h3>
            
            <!-- Rating -->
            ${rating > 0 ? `
              <div class="flex justify-center items-center gap-1 mb-2">
                ${generateStarRating(rating, 'text-xs')}
                <span class="text-xs text-gray-600">${rating}</span>
                <span class="text-xs text-gray-500">(${reviewStats.totalReviews})</span>
              </div>
            ` : '<div class="text-xs text-gray-400 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>'}
            
            <p class="text-purple-600 text-xs sm:text-sm mb-3 leading-relaxed px-2">${product.description.substring(0, 50)}...</p>
            
            <!-- Price & Action -->
            <div class="mb-2">
              <div class="text-xl sm:text-2xl font-black text-primary mb-3">‡∏ø${product.price.toLocaleString()}</div>
              <div class="flex flex-col gap-2">
                <a href="./product.html?id=${product.id}" 
                   class="inline-block bg-gradient-to-r from-primary to-primary-hover text-white font-bold py-2 px-4 rounded-full text-xs sm:text-sm transition-all duration-300 hover:shadow-lg hover:-translate-y-1 hover:scale-105">
                  üç¶ ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
                </a>
                <button onclick="quickAdd('${product.id}')" 
                        class="bg-gradient-to-r from-pastel-blue to-accent text-white font-bold py-2 px-4 rounded-full text-xs sm:text-sm transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
                  üõí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏¢
                </button>
              </div>
            </div>
          </div>`;
        
        slider.appendChild(slideDiv);
        
        // Create dot indicator
        const dot = document.createElement('button');
        dot.className = `w-2 h-2 rounded-full transition-all duration-300 ${index === currentFeaturedIndex ? 'bg-primary w-6' : 'bg-gray-300 hover:bg-gray-400'}`;
        dot.addEventListener('click', () => goToFeaturedSlide(index));
        dotsContainer.appendChild(dot);
      });
      
      updateFeaturedSlider();
    }

    function setupFeaturedNavigation() {
      const prevBtn = document.getElementById('featuredPrev');
      const nextBtn = document.getElementById('featuredNext');
      
      if (prevBtn) {
        prevBtn.addEventListener('click', () => {
          currentFeaturedIndex = currentFeaturedIndex > 0 ? currentFeaturedIndex - 1 : featuredProducts.length - 1;
          updateFeaturedSlider();
        });
      }
      
      if (nextBtn) {
        nextBtn.addEventListener('click', () => {
          currentFeaturedIndex = currentFeaturedIndex < featuredProducts.length - 1 ? currentFeaturedIndex + 1 : 0;
          updateFeaturedSlider();
        });
      }
    }

    function goToFeaturedSlide(index) {
      currentFeaturedIndex = index;
      updateFeaturedSlider();
    }

    function updateFeaturedSlider() {
      const slider = document.getElementById('featuredSlider');
      const dots = document.querySelectorAll('#featuredDots button');
      
      if (slider) {
        slider.style.transform = `translateX(-${currentFeaturedIndex * 100}%)`;
      }
      
      // Update dots
      dots.forEach((dot, index) => {
        if (index === currentFeaturedIndex) {
          dot.className = 'w-6 h-2 rounded-full bg-primary transition-all duration-300';
        } else {
          dot.className = 'w-2 h-2 rounded-full bg-gray-300 hover:bg-gray-400 transition-all duration-300';
        }
      });
    }

    // Auto-rotate featured products every 5 seconds
    let featuredAutoRotate;
    function startFeaturedAutoRotate() {
      featuredAutoRotate = setInterval(() => {
        if (featuredProducts.length > 1) {
          currentFeaturedIndex = currentFeaturedIndex < featuredProducts.length - 1 ? currentFeaturedIndex + 1 : 0;
          updateFeaturedSlider();
        }
      }, 5000);
    }

    function stopFeaturedAutoRotate() {
      if (featuredAutoRotate) {
        clearInterval(featuredAutoRotate);
      }
    }

    // Hero Image Slider
    let currentHeroSlide = 0;
    const heroSlides = document.querySelectorAll('.hero-slide');

    function nextHeroSlide() {
      if (heroSlides.length === 0) return;
      
      heroSlides[currentHeroSlide].style.opacity = '0';
      currentHeroSlide = (currentHeroSlide + 1) % heroSlides.length;
      heroSlides[currentHeroSlide].style.opacity = '1';
    }

    // Auto-rotate hero images every 4 seconds
    setInterval(nextHeroSlide, 4000);

    // Global functions for buttons
    window.clearFilters = function() {
      document.getElementById('searchInput').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('priceFilter').value = '';
      currentSearchTerm = '';
      currentCategory = '';
      currentPriceRange = '';
      filteredProducts = [];
      renderProducts();
      
      // Remove results count
      const countDisplay = document.getElementById('resultsCount');
      if (countDisplay) countDisplay.remove();
    };
    
    window.quickAdd = function(productId) {
      Cart.add(productId, 1);
      document.getElementById('cartCount').textContent = Cart.count();
      toast('‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß!');
    };

    // Favorites functionality
    window.toggleFavorite = function(productId, event) {
      event.preventDefault();
      event.stopPropagation();
      
      const user = currentUser();
      if (!user) {
        toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î', 'error');
        setTimeout(() => {
          window.location.href = './login.html';
        }, 1500);
        return;
      }

      // Initialize favorites array if it doesn't exist
      if (!user.favoriteProducts) {
        user.favoriteProducts = [];
      }

      const isFavorite = user.favoriteProducts.includes(productId);
      const product = PRODUCTS.find(p => p.id === productId);
      
      if (isFavorite) {
        // Remove from favorites
        user.favoriteProducts = user.favoriteProducts.filter(id => id !== productId);
        toast(`üíî ‡∏•‡∏ö "${product?.name || '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'}" ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß`, 'info');
      } else {
        // Add to favorites
        user.favoriteProducts.push(productId);
        toast(`‚ù§Ô∏è ‡πÄ‡∏û‡∏¥‡πà‡∏° "${product?.name || '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤'}" ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏õ‡∏£‡∏î‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
      }

      // Save to localStorage
      try {
        const users = JSON.parse(localStorage.getItem('app.users') || '[]');
        const userIndex = users.findIndex(u => u.email === user.email);
        if (userIndex !== -1) {
          users[userIndex] = user;
          localStorage.setItem('app.users', JSON.stringify(users));
          localStorage.setItem('app.auth.current.v1', JSON.stringify(user));
        }
      } catch (error) {
        console.error('Error saving favorites:', error);
        toast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        return;
      }

      // Update the button UI
      const button = event.target.closest('button');
      if (button) {
        if (isFavorite) {
          button.className = 'absolute top-2 right-2 w-8 h-8 rounded-full bg-white/80 backdrop-blur-sm text-gray-400 hover:text-red-500 flex items-center justify-center transition-all duration-300 hover:scale-110 z-10 shadow-md';
          button.innerHTML = 'ü§ç';
        } else {
          button.className = 'absolute top-2 right-2 w-8 h-8 rounded-full bg-red-500 text-white flex items-center justify-center transition-all duration-300 hover:scale-110 z-10 shadow-md';
          button.innerHTML = '‚ù§Ô∏è';
        }
      }
    };
    
    // Scroll functions
    window.scrollToTop = function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    
    // Progress bar and back to top button
    function updateScrollElements() {
      const scrolled = window.pageYOffset;
      const maxHeight = document.documentElement.scrollHeight - window.innerHeight;
      const progress = (scrolled / maxHeight) * 100;
      
      // Update progress bar
      const progressBar = document.getElementById('progress-bar');
      if (progressBar) {
        progressBar.style.width = progress + '%';
      }
      
      // Show/hide back to top button
      const backToTop = document.querySelector('.back-to-top');
      if (backToTop) {
        if (scrolled > 300) {
          backToTop.classList.add('visible');
        } else {
          backToTop.classList.remove('visible');
        }
      }
    }
    
    window.addEventListener('scroll', updateScrollElements);
    
    // Setup event listeners for filters
    document.addEventListener('DOMContentLoaded', function() {
      // Search input with debounce
      let searchTimeout;
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('input', function() {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            filterProducts();
          }, 300);
        });
      }
      
      // Category and price filters
      const categoryFilter = document.getElementById('categoryFilter');
      const priceFilter = document.getElementById('priceFilter');
      
      if (categoryFilter) {
        categoryFilter.addEventListener('change', filterProducts);
      }
      
      if (priceFilter) {
        priceFilter.addEventListener('change', filterProducts);
      }

      // Start featured carousel auto-rotation
      setTimeout(() => {
        startFeaturedAutoRotate();
      }, 1000);
    });
    
    // Stop auto-rotation when user interacts with carousel
    document.addEventListener('mouseenter', (e) => {
      if (e.target.closest('#featuredContainer')) {
        stopFeaturedAutoRotate();
      }
    });
    
    document.addEventListener('mouseleave', (e) => {
      if (e.target.closest('#featuredContainer')) {
        startFeaturedAutoRotate();
      }
    });
    
    // Render immediately with fallback data
    renderProducts();
    
    // Load full data from JSON and re-render
    async function init() {
      await loadIceCreamProducts();
      await loadReviews();
      renderProducts();
    }
    
    init();
  </script>
</body>
</html>
