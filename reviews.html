<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Äî Sweet Frozen</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'pastel-pink': '#ffb3ba',
            'pastel-peach': '#ffdfba',
            'pastel-yellow': '#ffffba',
            'pastel-green': '#baffc9',
            'pastel-blue': '#bae1ff',
            'pastel-purple': '#e1baff',
            'pastel-lavender': '#f0e6ff',
            'primary': '#ff8fab',
            'primary-hover': '#ff6b9d',
            'secondary': '#c8e6c9',
            'accent': '#b39ddb',
          },
          animation: {
            float: 'float 3s ease-in-out infinite',
            'slide-in-up': 'slideInUp 0.8s ease-out',
            'slide-in-left': 'slideInLeft 0.8s ease-out',
            'bounce-in': 'bounceIn 0.8s ease-out',
            sparkle: 'sparkle 2s ease-in-out infinite',
            wobble: 'wobble 0.5s ease-in-out'
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0px)' },
              '50%': { transform: 'translateY(-10px)' }
            },
            slideInUp: {
              from: { opacity: '0', transform: 'translateY(50px)' },
              to: { opacity: '1', transform: 'translateY(0)' }
            },
            slideInLeft: {
              from: { opacity: '0', transform: 'translateX(-50px)' },
              to: { opacity: '1', transform: 'translateX(0)' }
            },
            bounceIn: {
              '0%': { opacity: '0', transform: 'scale(0.3)' },
              '50%': { opacity: '1', transform: 'scale(1.05)' },
              '100%': { opacity: '1', transform: 'scale(1)' }
            },
            sparkle: {
              '0%, 100%': { opacity: '1', transform: 'scale(1) rotate(0deg)' },
              '50%': { opacity: '0.7', transform: 'scale(1.2) rotate(180deg)' }
            },
            wobble: {
              '0%, 100%': { transform: 'rotate(0deg)' },
              '25%': { transform: 'rotate(-3deg)' },
              '75%': { transform: 'rotate(3deg)' }
            }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="./assets/css/styles.css"/>
  <script type="module" src="./assets/js/app.js"></script>
</head>
<body>
  <div id="app-header"></div>
  
  <!-- Breadcrumb -->
  <nav class="max-w-6xl mx-auto px-4 py-2">
    <div class="flex items-center space-x-2 text-sm">
      <a href="./index.html" class="text-primary hover:text-primary-hover transition-colors">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <span class="text-gray-400">‚Ä∫</span>
      <span class="text-gray-800 font-medium">‚≠ê ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</span>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-12">
      <h1 class="text-4xl lg:text-6xl font-black bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent mb-4">
        ‚≠ê ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
      </h1>
      <p class="text-xl text-purple-700 mb-6">
        ‡∏ü‡∏±‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏•‡∏¥‡πâ‡∏°‡∏•‡∏≠‡∏á‡πÑ‡∏≠‡∏®‡∏Å‡∏£‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÅ‡∏•‡πâ‡∏ß
      </p>
    </div>

    <!-- Filter Section -->
    <div class="bg-white/30 backdrop-blur-lg rounded-2xl p-6 shadow-xl border border-white/20 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-bold text-purple-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</label>
          <select id="ratingFilter" class="w-full px-4 py-2 border-2 border-pastel-blue rounded-xl focus:border-primary focus:outline-none">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</option>
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5 ‡∏î‡∏≤‡∏ß)</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (4 ‡∏î‡∏≤‡∏ß)</option>
            <option value="3">‚≠ê‚≠ê‚≠ê (3 ‡∏î‡∏≤‡∏ß)</option>
            <option value="2">‚≠ê‚≠ê (2 ‡∏î‡∏≤‡∏ß)</option>
            <option value="1">‚≠ê (1 ‡∏î‡∏≤‡∏ß)</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-bold text-purple-700 mb-2">‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
          <select id="productFilter" class="w-full px-4 py-2 border-2 border-pastel-blue rounded-xl focus:border-primary focus:outline-none">
            <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
          </select>
        </div>
        
        <div>
          <label class="block text-sm font-bold text-purple-700 mb-2">‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°</label>
          <select id="sortFilter" class="w-full px-4 py-2 border-2 border-pastel-blue rounded-xl focus:border-primary focus:outline-none">
            <option value="newest">‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
            <option value="oldest">‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
            <option value="highest">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</option>
            <option value="lowest">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</option>
            <option value="helpful">‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Reviews List -->
    <div id="reviewsList" class="space-y-6">
      <!-- Loading placeholder -->
      <div class="text-center py-12">
        <div class="animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"></div>
        <div class="text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß...</div>
      </div>
    </div>

    <!-- Load More Button -->
    <div class="text-center mt-8">
      <button id="loadMoreBtn" class="hidden bg-gradient-to-r from-primary to-primary-hover text-white font-bold py-3 px-8 rounded-xl hover:shadow-lg transition-all">
        üìñ ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      </button>
    </div>
  </main>

  <div id="app-footer"></div>

  <script type="module">
    import { PRODUCTS, loadIceCreamProducts, getProduct } from './assets/js/products.js';
    import { updateHeader } from './assets/js/ui.js';
    import { 
      loadReviews, 
      getAllReviews,
      generateStarRating,
      formatRelativeTime,
      markReviewHelpful 
    } from './assets/js/reviews.js';

    let allReviews = [];
    let displayedReviews = [];
    let currentPage = 1;
    const reviewsPerPage = 10;

    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        updateHeader();
      }, 100);
    });

    async function init() {
      await loadIceCreamProducts();
      await loadReviews();
      
      allReviews = getAllReviews();
      populateProductFilter();
      applyFilters();
      setupEventListeners();
    }

    function populateProductFilter() {
      const productFilter = document.getElementById('productFilter');
      const uniqueProducts = [...new Set(allReviews.map(r => r.productId))];
      
      uniqueProducts.forEach(productId => {
        const product = getProduct(productId);
        if (product) {
          const option = document.createElement('option');
          option.value = productId;
          option.textContent = product.name;
          productFilter.appendChild(option);
        }
      });
    }

    function applyFilters() {
      const ratingFilter = document.getElementById('ratingFilter').value;
      const productFilter = document.getElementById('productFilter').value;
      const sortFilter = document.getElementById('sortFilter').value;

      let filtered = [...allReviews];

      // Filter by rating
      if (ratingFilter) {
        filtered = filtered.filter(review => review.rating === parseInt(ratingFilter));
      }

      // Filter by product
      if (productFilter) {
        filtered = filtered.filter(review => review.productId === productFilter);
      }

      // Sort reviews
      switch (sortFilter) {
        case 'newest':
          filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
          break;
        case 'oldest':
          filtered.sort((a, b) => new Date(a.date) - new Date(b.date));
          break;
        case 'highest':
          filtered.sort((a, b) => b.rating - a.rating);
          break;
        case 'lowest':
          filtered.sort((a, b) => a.rating - b.rating);
          break;
        case 'helpful':
          filtered.sort((a, b) => (b.helpful || 0) - (a.helpful || 0));
          break;
      }

      displayedReviews = filtered;
      currentPage = 1;
      renderReviews();
    }

    function renderReviews() {
      const reviewsList = document.getElementById('reviewsList');
      const loadMoreBtn = document.getElementById('loadMoreBtn');
      const startIndex = 0;
      const endIndex = currentPage * reviewsPerPage;
      const reviewsToShow = displayedReviews.slice(startIndex, endIndex);

      if (reviewsToShow.length === 0) {
        reviewsList.innerHTML = `
          <div class="text-center py-12 bg-white/30 backdrop-blur-lg rounded-2xl">
            <div class="text-6xl mb-4">ü§î</div>
            <div class="text-xl font-bold text-gray-700 mb-2">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
            <div class="text-gray-600">‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
          </div>
        `;
        loadMoreBtn.classList.add('hidden');
        return;
      }

      reviewsList.innerHTML = reviewsToShow.map(review => {
        const product = getProduct(review.productId);
        return `
          <div class="bg-white/30 backdrop-blur-lg rounded-2xl p-6 shadow-xl border border-white/20 hover:shadow-2xl transition-all animate-slide-in-up">
            <!-- Review Header -->
            <div class="flex justify-between items-start mb-4">
              <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-gradient-to-r from-primary to-accent rounded-full flex items-center justify-center text-white font-bold text-lg">
                  ${review.userName.charAt(0)}
                </div>
                <div>
                  <div class="font-bold text-gray-800">${review.userName}</div>
                  <div class="text-sm text-gray-500">${formatRelativeTime(review.date)}</div>
                  ${review.verified ? '<span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full">‚úì ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠</span>' : ''}
                </div>
              </div>
              <div class="flex items-center gap-2">
                ${generateStarRating(review.rating)}
              </div>
            </div>

            <!-- Product Info -->
            ${product ? `
              <div class="flex items-center gap-3 mb-4 p-3 bg-pastel-blue/30 rounded-xl">
                <img src="${product.image}" alt="${product.name}" class="w-12 h-12 object-cover rounded-full border-2 border-primary">
                <div>
                  <div class="font-medium text-primary">${product.name}</div>
                  <div class="text-sm text-gray-600">${product.category}</div>
                </div>
              </div>
            ` : ''}

            <!-- Review Content -->
            <div class="mb-4">
              <h4 class="font-bold text-gray-800 mb-2">${review.title}</h4>
              <p class="text-gray-700 leading-relaxed">${review.comment}</p>
            </div>

            <!-- Review Footer -->
            <div class="flex items-center justify-between pt-4 border-t border-gray-200">
              <button onclick="markHelpful('${review.id}')" 
                      class="text-gray-500 hover:text-primary transition-colors flex items-center gap-2 font-medium">
                üëç ‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå 
                <span class="bg-gray-100 text-gray-700 px-2 py-1 rounded-full text-sm">${review.helpful || 0}</span>
              </button>
              <div class="text-sm text-gray-400">${review.date}</div>
            </div>
          </div>
        `;
      }).join('');

      // Show/hide load more button
      if (endIndex < displayedReviews.length) {
        loadMoreBtn.classList.remove('hidden');
      } else {
        loadMoreBtn.classList.add('hidden');
      }
    }

    function setupEventListeners() {
      // Filter event listeners
      document.getElementById('ratingFilter').addEventListener('change', applyFilters);
      document.getElementById('productFilter').addEventListener('change', applyFilters);
      document.getElementById('sortFilter').addEventListener('change', applyFilters);

      // Load more button
      document.getElementById('loadMoreBtn').addEventListener('click', () => {
        currentPage++;
        renderReviews();
      });
    }

    // Global function for helpful button
    window.markHelpful = function(reviewId) {
      const newCount = markReviewHelpful(reviewId);
      
      // Update the display
      const button = document.querySelector(`button[onclick="markHelpful('${reviewId}')"]`);
      if (button) {
        const countSpan = button.querySelector('span');
        if (countSpan) {
          countSpan.textContent = newCount;
        }
      }
    };

    init();
  </script>
</body>
</html>
